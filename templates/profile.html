<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×”××–×•×¨ ×”××™×©×™</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">
</head>
<body>
        <nav>              
            <a href="{{ url_for('save_data') }}">×’×™×‘×•×™ × ×ª×•× ×™×</a>           
            <a href="{{ url_for('graph1') }}">×’×¨×£ ×¨×›×™×©×•×ª ×œ×¤×™ ×§×˜×’×•×¨×™×”</a>
            <a href="{{ url_for('graph2') }}">×’×¨×£ ×¨×›×™×©×•×ª ×œ×¤×™ ×—×•×“×©×™×</a>
            <a href="{{ url_for('optimize_shopping') }}" class="btn">×™×™×¢×•×œ ×§× ×™×•×ª</a>
            <a href="{{ url_for('home') }}">×—×–×¨×” ×œ×“×£ ×”×‘×™×ª</a>
            <a href="{{ url_for('logout') }}">×”×ª× ×ª×§</a>
        </nav>
        <h2>×©×œ×•× {{ user.username }}!</h2>
    <div class="profile-container">         
        <h3>×”×¨×›×™×©×•×ª ×©×œ×š:</h3>
        <form method="GET" onsubmit="searchByDates(event)" class="date-search-form">
                <label>××ª××¨×™×š:</label>
                <input type="date" id="start_date" required>
                <label>×¢×“ ×ª××¨×™×š:</label>
                <input type="date" id="end_date" required>
                <button type="submit">×”×¦×’ ×¨×›×™×©×•×ª ×‘×˜×•×•×—</button>
                <a href="{{ url_for('download_data') }}">
                    <img src="{{ url_for('static', filename='images/download.png') }}" alt="×”×•×¨×“ ×§×•×‘×¥" style="width:30px; height:30px; cursor:pointer;">
                </a>
        </form>
       
        {% if error %}
            <p style="color: red;">{{ error }}</p>
        {% else %}
            
        {% if purchases %}
            <div class="purchases-grid">
                {% for p in purchases %}
                    <div class="purchase-card">
                        <h4>×©× ××•×¦×¨:  {{ p.name }}</h4>
                        <p><strong>×›××•×ª:</strong> {{ p.quantity }} ×™×—×™×“×•×ª</p>
                        <p><strong>××—×™×¨:</strong> {{ p.price }} â‚ª</p>
                        <p><strong>×ª××¨×™×š:</strong> {{ p.date.strftime('%d/%m/%Y') }}</p>
                        <form method="POST" action="{{ url_for('delete_purchase', purchase_id=p.id) }}" onsubmit="return confirm('××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§?');">
                            <button type="submit" class="btn btn-danger btn-sm">ğŸ—‘ï¸</button>
                        </form>                        
                    </div>
        {% endfor %}
            </div>                
            {% else %}
                <p>××™×Ÿ ×œ×š ×¢×“×™×™×Ÿ ×¨×›×™×©×•×ª.</p>
            {% endif %}
        {% endif %}           
        <!-- ×œ×™× ×§ ×œ×“×£ ×”×•×¡×¤×ª ×¨×›×™×©×” -->
        <a href="{{ url_for('add_purchase') }}">
            <button>×”×•×¡×£ ×¨×›×™×©×”</button>
        </a>        
    </div>
     <!--×¤×•× ×§×¦×™×ª ×—×™×¤×•×© ×œ×¤×™ ×ª××¨×™×š-->      
     <script>
        function searchByDates(event) {
            event.preventDefault();
            const start = document.getElementById('start_date').value;
            const end = document.getElementById('end_date').value;
            const formatDate = (str) => {
            const parts = str.split("-");
                return `${parts[2]}-${parts[1]}-${parts[0]}`;
            };            
            const formattedStart = formatDate(start);
            const formattedEnd = formatDate(end);
            window.location.href = `/profile/${formattedStart}/${formattedEnd}`;
        }
    </script>            
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <ul class="flashes">
                {% for category, message in messages %}
                    <li class="flash-{{ category }}">{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    {% endwith %} 

    
    
</body>
</html>
